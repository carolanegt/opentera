<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Internal messages structure &mdash; OpenTera 1.2.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Services Access" href="../services/Services-Access.html" />
    <link rel="prev" title="Login &amp; Authentification" href="Login-and-authentication.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OpenTera
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Home.html">About OpenTera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Architecture-Overview.html">OpenTera Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Security.html">Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Deployment.html">Deploying OpenTera on a server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Configuration-files.html">Configuration files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Developers.html">Developers setup guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services and Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../services/OpenTera_Services.html">OpenTera Services Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/services.html">Services</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Service-Creation.html">Creating a new service based on OpenTera</a></li>
<li class="toctree-l1"><a class="reference internal" href="Code-Structure.html">Code structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Database-Structure.html">Database Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Form-Structure.html">Internal Form Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Internal-services-communication-module.html">Inter-service communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="Login-and-authentication.html">Login &amp; Authentification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Internal messages structure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#message-wrappers">Message wrappers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-message-wrapper-teramessage">General message wrapper (TeraMessage)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event-wrapper-teraevent">Event wrapper (TeraEvent)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-message-wrapper-teramodulemessage">Module message wrapper (TeraModuleMessage)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#specific-events-messages">Specific events messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#users-participants-and-devices">Users, participants and devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#deviceevent"><code class="docutils literal notranslate"><span class="pre">DeviceEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#participantevent"><code class="docutils literal notranslate"><span class="pre">ParticipantEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#userevent"><code class="docutils literal notranslate"><span class="pre">UserEvent</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sessions">Sessions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#joinsessionevent"><code class="docutils literal notranslate"><span class="pre">JoinSessionEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#joinsessionreplyevent"><code class="docutils literal notranslate"><span class="pre">JoinSessionReplyEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#leavesessionevent"><code class="docutils literal notranslate"><span class="pre">LeaveSessionEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#stopsessionevent"><code class="docutils literal notranslate"><span class="pre">StopSessionEvent</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#opentera-modules-system-services">OpenTera modules &amp; system services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#databaseevent"><code class="docutils literal notranslate"><span class="pre">DatabaseEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#logevent"><code class="docutils literal notranslate"><span class="pre">LogEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#rpcmessage"><code class="docutils literal notranslate"><span class="pre">RPCMessage</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/Services-Access.html">Services Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="Websockets-communication.html">Websockets communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="Running-tests.html">Running Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="Translations.html">Translations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenTera</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Internal messages structure</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developers/Messages-structure.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="internal-messages-structure">
<h1>Internal messages structure<a class="headerlink" href="#internal-messages-structure" title="Permalink to this heading"></a></h1>
<p><a class="reference internal" href="Internal-services-communication-module.html"><span class="doc std std-doc">Communication between the various modules and service</span></a> and <a class="reference internal" href="Websockets-communication.html"><span class="doc std std-doc">between the server and the clients</span></a> is based on standardized messages and events. All of the messages and events are serialized and defined with the <a class="reference external" href="https://developers.google.com/protocol-buffers">protocol buffers (probuf)</a> mechanism.</p>
<p>Since clients could be implemented in any language and will need to reuse the messages structure, an external repository, <a class="reference external" href="https://github.com/introlab/opentera_messages">opentera-messages</a>, is used for that purpose.</p>
<section id="message-wrappers">
<h2>Message wrappers<a class="headerlink" href="#message-wrappers" title="Permalink to this heading"></a></h2>
<section id="general-message-wrapper-teramessage">
<h3>General message wrapper (TeraMessage)<a class="headerlink" href="#general-message-wrapper-teramessage" title="Permalink to this heading"></a></h3>
<p>All messages that are going out through the <a class="reference internal" href="Websockets-communication.html"><span class="doc std std-doc">websocket channels</span></a> to the clients are wrapped in the <a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/TeraMessage.proto"><code class="docutils literal notranslate"><span class="pre">TeraMessage</span></code></a> structure.</p>
<p>The wrapper is quite simple and only contains an <code class="docutils literal notranslate"><span class="pre">Any</span></code> field. Since protobuf’s Any allows for type detection, this allows the client to identify the type of the content of the message without explicitly having to try to cast to any known type and see if it makes senses.</p>
<p><code class="docutils literal notranslate"><span class="pre">TeraMessage</span></code> wrapper is currently not used for internal message communications.</p>
</section>
<section id="event-wrapper-teraevent">
<h3>Event wrapper (TeraEvent)<a class="headerlink" href="#event-wrapper-teraevent" title="Permalink to this heading"></a></h3>
<p>All events going in and out of the OpenTera server are wrapped in a <a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/TeraEvent.proto"><code class="docutils literal notranslate"><span class="pre">TeraEvent</span></code></a> structure.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Header</span></code> part of the event is self-explanatory. The <code class="docutils literal notranslate"><span class="pre">topic</span></code> field is used as a way to identify the <a class="reference internal" href="Internal-services-communication-module.html"><span class="doc std std-doc">internal communication system</span></a> topic being used to send that event.</p>
<p>A single <code class="docutils literal notranslate"><span class="pre">TeraEvent</span></code> wrapper can contains multiple events, if needed.</p>
<p>Same as with <code class="docutils literal notranslate"><span class="pre">TeraMessage</span></code>, the <code class="docutils literal notranslate"><span class="pre">Any</span></code> field in that structure allows for easier type detection in the receiver.</p>
</section>
<section id="module-message-wrapper-teramodulemessage">
<h3>Module message wrapper (TeraModuleMessage)<a class="headerlink" href="#module-message-wrapper-teramodulemessage" title="Permalink to this heading"></a></h3>
<p>Message that are adressed to one of the module are wrapped in a <a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/TeraModuleMessage.proto"><code class="docutils literal notranslate"><span class="pre">TeraModuleMessage</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Header</span></code> part of the message is self-explanatory. <code class="docutils literal notranslate"><span class="pre">seq</span></code> is a unique sequence number, while <code class="docutils literal notranslate"><span class="pre">source</span></code> contains who is sending the message to the module, while the <code class="docutils literal notranslate"><span class="pre">dest</span></code> contains the specific module topic.</p>
<p>A single <code class="docutils literal notranslate"><span class="pre">TeraModuleMessage</span></code> can contain multiple, if needed.</p>
<p>Same as with <code class="docutils literal notranslate"><span class="pre">TeraMessage</span></code>, the <code class="docutils literal notranslate"><span class="pre">Any</span></code> field in that structure allows for easier type detection in the receiver.</p>
</section>
</section>
<section id="specific-events-messages">
<h2>Specific events messages<a class="headerlink" href="#specific-events-messages" title="Permalink to this heading"></a></h2>
<section id="users-participants-and-devices">
<h3>Users, participants and devices<a class="headerlink" href="#users-participants-and-devices" title="Permalink to this heading"></a></h3>
<p>Those events indicate a status change in users, participants or devices. The specific status are defined and described in each of the messages proto below.</p>
<section id="deviceevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/DeviceEvent.proto"><code class="docutils literal notranslate"><span class="pre">DeviceEvent</span></code></a><a class="headerlink" href="#deviceevent" title="Permalink to this heading"></a></h4>
<p>Device event.</p>
</section>
<section id="participantevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/ParticipantEvent.proto"><code class="docutils literal notranslate"><span class="pre">ParticipantEvent</span></code></a><a class="headerlink" href="#participantevent" title="Permalink to this heading"></a></h4>
<p>Participant event.</p>
</section>
<section id="userevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/UserEvent.proto"><code class="docutils literal notranslate"><span class="pre">UserEvent</span></code></a><a class="headerlink" href="#userevent" title="Permalink to this heading"></a></h4>
<p>User event.</p>
</section>
</section>
<section id="sessions">
<h3>Sessions<a class="headerlink" href="#sessions" title="Permalink to this heading"></a></h3>
<p>Those events are generated with session management services.</p>
<section id="joinsessionevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/JoinSessionEvent.proto"><code class="docutils literal notranslate"><span class="pre">JoinSessionEvent</span></code></a><a class="headerlink" href="#joinsessionevent" title="Permalink to this heading"></a></h4>
<p>Event to invite a specific user, participant and/or device to join a session.</p>
</section>
<section id="joinsessionreplyevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/JoinSessionReplyEvent.proto"><code class="docutils literal notranslate"><span class="pre">JoinSessionReplyEvent</span></code></a><a class="headerlink" href="#joinsessionreplyevent" title="Permalink to this heading"></a></h4>
<p>Event indicating that a specific user, participant or device replied to a <code class="docutils literal notranslate"><span class="pre">JoinSessionEvent</span></code></p>
</section>
<section id="leavesessionevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/LeaveSessionEvent.proto"><code class="docutils literal notranslate"><span class="pre">LeaveSessionEvent</span></code></a><a class="headerlink" href="#leavesessionevent" title="Permalink to this heading"></a></h4>
<p>Event indicating that a specific user, participant or device left the session. Also use to indicate to a user, participant or device that it needs to leave the session now.</p>
</section>
<section id="stopsessionevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/StopSessionEvent.proto"><code class="docutils literal notranslate"><span class="pre">StopSessionEvent</span></code></a><a class="headerlink" href="#stopsessionevent" title="Permalink to this heading"></a></h4>
<p>Event indicating that a specific session was terminated.</p>
</section>
</section>
<section id="opentera-modules-system-services">
<h3>OpenTera modules &amp; system services<a class="headerlink" href="#opentera-modules-system-services" title="Permalink to this heading"></a></h3>
<p>Those events are generated or used to communicate with some of the modules and systems service in the OpenTera platform.</p>
<section id="databaseevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/DatabaseEvent.proto"><code class="docutils literal notranslate"><span class="pre">DatabaseEvent</span></code></a><a class="headerlink" href="#databaseevent" title="Permalink to this heading"></a></h4>
<p>Event generated when a database change (update, delete, create) occurred. Also see the <a class="reference internal" href="Database-Structure.html"><span class="doc std std-doc">database objects</span></a> for the model names.</p>
</section>
<section id="logevent">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/LogEvent.proto"><code class="docutils literal notranslate"><span class="pre">LogEvent</span></code></a><a class="headerlink" href="#logevent" title="Permalink to this heading"></a></h4>
<p>Event sent to the <a class="reference internal" href="../services/Logging-Service.html"><span class="doc std std-doc">logging service</span></a> to add a system log in the log archive.</p>
</section>
<section id="rpcmessage">
<h4><a class="reference external" href="https://github.com/introlab/opentera_messages/blob/master/proto/RPCMessage.proto"><code class="docutils literal notranslate"><span class="pre">RPCMessage</span></code></a><a class="headerlink" href="#rpcmessage" title="Permalink to this heading"></a></h4>
<p>Event used to make <a class="reference internal" href="Internal-services-communication-module.html"><span class="doc std std-doc">remote procedure calls (RPC)</span></a> with another service.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Login-and-authentication.html" class="btn btn-neutral float-left" title="Login &amp; Authentification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../services/Services-Access.html" class="btn btn-neutral float-right" title="Services Access" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Simon Brière, Dominic Létourneau.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>